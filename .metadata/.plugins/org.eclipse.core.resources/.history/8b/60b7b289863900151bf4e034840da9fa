package edu.tier2.businessLayer;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;

import edu.tier1.managedBean.EducationBean;
import edu.tier1.managedBean.StudentProfileDetailsBean;
import edu.tier1.managedBean.UserBean;
import edu.tier1.managedBean.WorkExperienceBean;
import edu.tier3.dataAccessLayer.ProfileDAL;
import edu.tier3.dataEntities.Student;
import edu.tier3.dataEntities.StudentEducationDetail;
import edu.tier3.dataEntities.StudentEmployementHistory;

public class ProfileBL {
	public HashMap loadStudentProfileDetails(HashMap credentialsMap){
		ProfileDAL profileDAL = new ProfileDAL();
		UserBean ub = (UserBean)credentialsMap.get("userBean");
		
		HashMap userMap = new HashMap();
		userMap.put("userId", ub.getUid());
		HashMap returnMap = profileDAL.loadStudentProfileDetails(userMap);
		
		Student studentProfile = (Student) returnMap.get("studentProfile");
		StudentProfileDetailsBean studentProfileDetailsBean = (StudentProfileDetailsBean) credentialsMap.get("studentProfileDetailsBean");
		
		//Start student details load
		studentProfileDetailsBean.getUserBean().setName(studentProfile.getFirstName() + " " + studentProfile.getMiddleName() + " " + studentProfile.getLastName());
		//studentProfileBean.getUserBean().setRole(studentProfile.getUser().getRoleId());
		studentProfileDetailsBean.getUserBean().setEmail(studentProfile.getUser().getUserDetail().getEmail1());
		
		EducationBean eb = null;
		List<EducationBean> educationBeanList = new ArrayList<EducationBean>();
		StudentEducationDetail eE = null;
		for(int i=0; i<studentProfile.getStudentEducationDetails().size();i++){
			eb = new EducationBean();
			eE = studentProfile.getStudentEducationDetails().get(i);
			eb.setMajor(eE.getMajor().getMajorName());
			eb.setSchool(eE.getSchool().getSchoolName());
			eb.setStartDate(eE.getStartDate().toString());
			eb.setEndDate(eE.getEndDate().toString());
			eb.setCgpa(String.valueOf(eE.getCgpa()));
			eb.setUniversity(eE.getUniversity().getUnivName());
			eb.setDefendValue(eE.getDefendValue());
			
			educationBeanList.add(eb);
		}
		studentProfileDetailsBean.setEducationBeans(educationBeanList);
		
		WorkExperienceBean web = null;
		List<WorkExperienceBean> workExpBeanList = new ArrayList<WorkExperienceBean>();
		StudentEmployementHistory seh = null;
		for(int i=0; i<studentProfile.getStudentEmployementHistories().size();i++){
			web = new WorkExperienceBean();
			seh = studentProfile.getStudentEmployementHistories().get(i);
			web.setPositionTitle(seh.getJobTitle());
			web.setStartDate(seh.getStartDate().toString());
			web.setEndDate(seh.getEndDate().toString());
			web.setCompany(seh.getCompany().getCompanyName());
			web.setManager(seh.getManagerName());
			web.setManagerTitle(seh.getManagerTitle());
			web.setDefendValue(seh.getDefendFlag());
			web.setProjectDetails(seh.getWorkDescription().toString());
			
			workExpBeanList.add(web);
		}
		studentProfileDetailsBean.setWorkExperienceBeans(workExpBeanList);
		
		
		//End student details load
		HashMap retMap= new HashMap();
		return retMap;
	}
}
